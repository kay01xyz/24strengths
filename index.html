<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>VIA Character Survey</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 載入 Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 載入 React, ReactDOM (以 CDN 方式) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.5.0/Recharts.min.js"></script>
</head>
<body class="bg-gray-100">
  <!-- React 將掛載在這個節點上 -->
  <div id="preview-app"></div>

  <!-- 主要腳本：定義 VIACharacterSurvey 組件與渲染邏輯 -->
  <script>
    // 從全域取得 React (因為我們在 <head> 中以 <script> 方式引入)
    const {
      useState,
      useEffect,
      useMemo
    } = React;

    /**********************************************
     * 多國語言翻譯資料
     **********************************************/
    const translations = {
      'zh-TW': {
        // UI 文字
        surveyTitle: "品格強項問卷",
        surveySubtitle: "探索您的獨特優勢與潛能",
        aboutSurvey: "關於本問卷",
        aboutSurveyP1: "這份問卷基於正向心理學的研究，設計用來幫助您發現並了解自己的24項品格強項以及六大美德。通過完成這份評估，您將對自己的核心優勢有深入洞見。",
        aboutSurveyP2: "問卷包括96個問題，只需根據符合您自身情況的程度進行選擇。整個過程預計花費10-15分鐘。",
        whatSurveyHelps: "問卷將幫助您：",
        helpListItem1: "• 識別您最突出的品格強項",
        helpListItem2: "• 了解六大美德在您性格中的分佈",
        helpListItem3: "• 發現可以進一步發展的潛在領域",
        sixVirtues: "六大美德領域",
        startTestBtn: "開始測試",
        surveyDisclaimer: "基於正向心理學與品格強項的研究 • 本問卷結果僅供參考",
        testTitle: "品格強項測試",
        testInstruction: "請選擇最符合您的想法或行為的程度（1-5分）",
        progress: "進度",
        completed: "已完成",
        pageInfo: (current, total) => `第 ${current} 頁，共 ${total} 頁`,
        questionCount: (answered, total) => `${answered}/${total} 題`,
        clearPageAnswers: "清除此頁所有回答",
        clearConfirm: "確定要清除此頁所有回答嗎？",
        nextPageBtn: "下一頁",
        prevPageBtn: "上一頁",
        submitBtn: "提交完成",
        unansweredAlert: "此頁尚有題目未完成：\n",
        incompleteAlert: "請先完成所有題目再提交！",
        resultsTitle: "您的品格強項分析",
        resultsSubtitle: "以下展示了您最突出的前五大品格強項",
        topFiveStrengths: "您的前五大品格強項",
        aboutYourStrengths: "關於您的品格強項",
        aboutStrengthsP1: "品格強項是一個人天生具備且自然而然能夠表現出來的特質。這些特質能讓我們在面對生活中的各種挑戰時，更有效地應對並獲得心靈的滿足感。",
        aboutStrengthsP2: "您的前五大強項代表了您最自然、最核心的特質。在日常生活和工作中充分發揮這些強項，將幫助您更有效地面對挑戰，體驗更多的成就感和幸福感。",
        restartBtn: "重新開始測試",
        restartConfirm: "確定要重新開始測試嗎？所有答案將被清除。",
        score5: "非常像我",
        score4: "比較像我",
        score3: "中立",
        score2: "不太像我",
        score1: "非常不像我",
        // 六大美德與24品格強項
        virtues: {
          wisdom: "智慧與知識 (Wisdom & Knowledge)",
          courage: "勇氣 (Courage)",
          humanity: "人道 (Humanity)",
          justice: "正義 (Justice)",
          temperance: "節制 (Temperance)",
          transcendence: "超越 (Transcendence)",
        },
        strengths: {
          creativity: "創造力 (Creativity)",
          curiosity: "好奇心 (Curiosity)",
          judgment: "判斷力 (Judgment)",
          love_of_learning: "熱愛學習 (Love of Learning)",
          perspective: "洞見/全局觀 (Perspective)",
          bravery: "勇敢 (Bravery)",
          perseverance: "堅毅 (Perseverance)",
          honesty: "誠實 (Honesty)",
          zest: "熱忱 / 活力 (Zest)",
          love: "愛 (Love)",
          kindness: "善良 (Kindness)",
          social_intelligence: "社交智慧 (Social Intelligence)",
          teamwork: "團隊合作 (Teamwork)",
          fairness: "公平 (Fairness)",
          leadership: "領導 (Leadership)",
          forgiveness: "寬恕 (Forgiveness)",
          humility: "謙遜 (Humility)",
          prudence: "審慎 (Prudence)",
          self_regulation: "自我調節 (Self-Regulation)",
          appreciation_of_beauty: "美與卓越的欣賞 (Appreciation of Beauty & Excellence)",
          gratitude: "感恩 (Gratitude)",
          hope: "希望 (Hope)",
          humor: "幽默 (Humor)",
          spirituality: "靈性 (Spirituality)",
        },
        virtue_desc: {
          wisdom: "認知優勢，涉及知識的獲取與運用。",
          courage: "情感優勢，涉及在面對外部或內部阻力時運用意志完成目標。",
          humanity: "人際優勢，涉及照顧和友善對待他人。",
          justice: "公民優勢，是健康社區生活的基礎。",
          temperance: "防止過度的優勢。",
          transcendence: "與更廣闊宇宙建立連結並提供意義的優勢。",
        },
        questions: {
          creativity_1: "我是一個具有創造性思維的人。", creativity_2: "我總是想到許多新的做事方式。", creativity_3: "我對自己的原創性感到自豪。", creativity_4: "我朋友說我有很多新穎及不同的想法。",
          curiosity_1: "我對這個世界總是感到好奇。", curiosity_2: "我有許多興趣。", curiosity_3: "我認為生活是非常有趣的。", curiosity_4: "遇到新的人事物我總想了解更多。",
          judgment_1: "當我要做決定時，我會果斷地根據客觀資訊作出判斷。", judgment_2: "我總是能從正反兩面檢視事物。", judgment_3: "只有當我掌握事實我才會做出決定。", judgment_4: "每一個重要決定，我都能羅列充分的理由。",
          love_of_learning_1: "我喜愛學習新事物。", love_of_learning_2: "我總是熱衷參與各種學習活動。", love_of_learning_3: "我一定是一位終身學習者。", love_of_learning_4: "我從未錯過學習新事物的機會。",
          perspective_1: "我是一個很有智慧的人。", perspective_2: "別人認為我是一個有洞見的人。", perspective_3: "別人總會向我詢問意見。", perspective_4: "我精於融會貫通不同領域的知識。",
          bravery_1: "要公開表達不受歡迎但有用的言論，我不會遲疑。", bravery_2: "當我聽到某人對他人說出不厚道的話時，我會表達異議。", bravery_3: "我是一位勇敢的人。", bravery_4: "面對強大的反對，我會秉持自己的立場。",
          perseverance_1: "儘管途中有所阻礙，我一定會完成事情。", perseverance_2: "我擅長完成任務，不管它們有多困難。", perseverance_3: "我總是能有始有終。", perseverance_4: "我從不半途而廢。",
          honesty_1: "我的承諾值得完全信任。", honesty_2: "我總是信守承諾。", honesty_3: "隱瞞或說慌是有必要的。", honesty_4: "我會說實話儘管這意味著我會惹上麻煩。",
          zest_1: "我總是興奮地開展每一天。", zest_2: "人們會描述我是充滿熱忱的。", zest_3: "我天天活力充沛。", zest_4: "我為一天中的各種可能性感到興奮。",
          love_1: "我可以安心地接納他人的愛。", love_2: "我會非常努力去鼓舞失落的人。", love_3: "我擅長向他人表達我的關愛。", love_4: "我時常表達我對於他人的愛。",
          kindness_1: "我總是樂於主動幫助朋友一些小忙。", kindness_2: "幫助朋友對我而言從不感到壓力。", kindness_3: "我總是盡力去幫助有需要的人。", kindness_4: "我相信每個人有自己的責任，很少幫助別人。",
          social_intel_1: "我總是懂得說出讓人們感覺美好的話。", social_intel_2: "我總是和我剛認識的人相處得很好。", social_intel_3: "我總能和別人維持長久而深厚的關係。", social_intel_4: "我能輕易體會他人所處的情境與想法。",
          teamwork_1: "當我是一個團隊成員時，我會盡力工作。", teamwork_2: "我真的樂於成為團體的一員。", teamwork_3: "對我而言，尊重團隊所做的決定極之重要。", teamwork_4: "我給與我的團隊成員絕對的支持。",
          fairness_1: "我平等對待每個人。", fairness_2: "我從不因個人好惡而影響公正判斷。", fairness_3: "即使我不喜歡某人，我也會公平地對待他。", fairness_4: "我不預設任何成見去評斷他人。",
          leadership_1: "人們總是找我來領導一個團體。", leadership_2: "我非常擅長帶領團隊活動。", leadership_3: "我擅於協助一群有差異的人彼此合作。", leadership_4: "我總能鼓勵並激發團隊成員的潛能。",
          forgiveness_1: "我認為最好的事是原諒與遺忘。", forgiveness_2: "我不想看到任何人受苦，即使是與我為敵的人。", forgiveness_3: "我從不懷恨在心。", forgiveness_4: "我總是願意給予別人改正的機會。",
          humility_1: "對於發生在我身上的好事，我總是謙虛以對。", humility_2: "我絕不自誇我的成就。", humility_3: "我偏好多聽別人的經驗之談。", humility_4: "有人說謙遜是我的特質之一。",
          prudence_1: "我總能在說話前先三思。", prudence_2: "我總是做出審慎的選擇。", prudence_3: "我是一位非常謹慎小心的人。", prudence_4: "在行動之前，我會極之認真考慮後果。",
          self_regulation_1: "當我工作時，我不會輕易分心。", self_regulation_2: "對我而言，維持自律並不困難。", self_regulation_3: "我能克制自己停止沒有建設性的行為。", self_regulation_4: "我能抗拒誘惑。",
          beauty_excellence_1: "我總能會從他人忽略的事物中看見美好。", beauty_excellence_2: "當我看到美麗事物時，我會深受感動。", beauty_excellence_3: "對我而言，生活在美好環境十分重要。", beauty_excellence_4: "我總能覺察周遭的自然美。",
          gratitude_1: "我每天至少一次會列舉上天所賜予的恩惠。", gratitude_2: "我是一位非常懂得感恩的人。", gratitude_3: "我的生命中幸運之事接踵而至。", gratitude_4: "當我感到沮喪時，總會想及我生命中的美好事物。",
          hope_1: "面對挑戰時，我依然對未來充滿希望。", hope_2: "我習慣在負面情況中發現正面機會。", hope_3: "我相信我能實現我設定的目標。", hope_4: "我堅信逆境終將過去，迎向更好的未來。",
          humor_1: "我總能用幽默緩和尷尬或緊張的場面。", humor_2: "我每天都用機智的玩笑逗樂身邊的人。", humor_3: "我擅於在日常瑣事中發現好笑的一面。", humor_4: "我懂得拿捏玩笑分寸，並用幽默帶給他人正面感受。",
          spirituality_1: "我的信念支撐了我生命的意義。", spirituality_2: "我是一位具有靈性信仰的人。", spirituality_3: "我相信我在這世界上有一個使命。", spirituality_4: "我的信念塑造了現在的我。",
        }
      },
      'zh-CN': {
        // UI 文字
        surveyTitle: "品格优势问卷",
        surveySubtitle: "探索您的独特优势与潜能",
        aboutSurvey: "关于本问卷",
        aboutSurveyP1: "这份问卷基于正向心理学的研究，设计用来帮助您发现并了解自己的24项品格优势以及六大美德。通过完成这份评估，您将对自己的核心优势有深入洞见。",
        aboutSurveyP2: "问卷包括96个问题，只需根据符合您自身情况的程度进行选择。整个过程预计花费10-15分钟。",
        whatSurveyHelps: "问卷将帮助您：",
        helpListItem1: "• 识别您最突出的品格优势",
        helpListItem2: "• 了解六大美德在您性格中的分布",
        helpListItem3: "• 发现可以进一步发展的潜在领域",
        sixVirtues: "六大美德领域",
        startTestBtn: "开始测试",
        surveyDisclaimer: "基于正向心理学与品格优势的研究 • 本问卷结果仅供参考",
        testTitle: "品格优势测试",
        testInstruction: "请选择最符合您的想法或行为的程度（1-5分）",
        progress: "进度",
        completed: "已完成",
        pageInfo: (current, total) => `第 ${current} 页，共 ${total} 页`,
        questionCount: (answered, total) => `${answered}/${total} 题`,
        clearPageAnswers: "清除此页所有回答",
        clearConfirm: "确定要清除此页所有回答吗？",
        nextPageBtn: "下一页",
        prevPageBtn: "上一页",
        submitBtn: "提交完成",
        unansweredAlert: "此页尚有题目未完成：\n",
        incompleteAlert: "请先完成所有题目再提交！",
        resultsTitle: "您的品格优势分析",
        resultsSubtitle: "以下展示了您最突出的前五大品格优势",
        topFiveStrengths: "您的前五大品格优势",
        aboutYourStrengths: "关于您的品格优势",
        aboutStrengthsP1: "品格优势是一个人天生具备且自然而然能够表现出来的特质。这些特质能让我们在面对生活中的各种挑战时，更有效地应对并获得心灵的满足感。",
        aboutStrengthsP2: "您的前五大优势代表了您最自然、最核心的特质。在日常生活和工作中充分发挥这些优势，将帮助您更有效地面对挑战，体验更多的成就感和幸福感。",
        restartBtn: "重新开始测试",
        restartConfirm: "确定要重新开始测试吗？所有答案将被清除。",
        score5: "非常像我",
        score4: "比较像我",
        score3: "中立",
        score2: "不太像我",
        score1: "非常不像我",
        // 六大美德与24品格优势
        virtues: {
          wisdom: "智慧与知识 (Wisdom & Knowledge)",
          courage: "勇气 (Courage)",
          humanity: "人道 (Humanity)",
          justice: "正义 (Justice)",
          temperance: "节制 (Temperance)",
          transcendence: "超越 (Transcendence)",
        },
        strengths: {
          creativity: "创造力 (Creativity)",
          curiosity: "好奇心 (Curiosity)",
          judgment: "判断力 (Judgment)",
          love_of_learning: "热爱学习 (Love of Learning)",
          perspective: "洞见/全局观 (Perspective)",
          bravery: "勇敢 (Bravery)",
          perseverance: "坚毅 (Perseverance)",
          honesty: "诚实 (Honesty)",
          zest: "热忱 / 活力 (Zest)",
          love: "爱 (Love)",
          kindness: "善良 (Kindness)",
          social_intelligence: "社交智慧 (Social Intelligence)",
          teamwork: "团队合作 (Teamwork)",
          fairness: "公平 (Fairness)",
          leadership: "领导力 (Leadership)",
          forgiveness: "宽恕 (Forgiveness)",
          humility: "谦逊 (Humility)",
          prudence: "审慎 (Prudence)",
          self_regulation: "自我调节 (Self-Regulation)",
          appreciation_of_beauty: "美与卓越的欣赏 (Appreciation of Beauty & Excellence)",
          gratitude: "感恩 (Gratitude)",
          hope: "希望 (Hope)",
          humor: "幽默 (Humor)",
          spirituality: "灵性 (Spirituality)",
        },
        virtue_desc: {
          wisdom: "认知优势，涉及知识的获取与运用。",
          courage: "情感优势，涉及在面对外部或内部阻力时运用意志完成目标。",
          humanity: "人际优势，涉及照顾和友善对待他人。",
          justice: "公民优势，是健康社区生活的基础。",
          temperance: "防止过度的优势。",
          transcendence: "与更广阔宇宙建立连结并提供意义的优势。",
        },
        questions: {
          creativity_1: "我是一个具有创造性思维的人。", creativity_2: "我总是想到许多新的做事方式。", creativity_3: "我对自己的原创性感到自豪。", creativity_4: "我朋友说我有很多新颖及不同的想法。",
          curiosity_1: "我对这个世界总是感到好奇。", curiosity_2: "我有许多兴趣。", curiosity_3: "我认为生活是非常有趣的。", curiosity_4: "遇到新的人事物我总想了解更多。",
          judgment_1: "当我要做决定时，我会果断地根据客观信息作出判断。", judgment_2: "我总是能从正反两面检视事物。", judgment_3: "只有当我掌握事实我才会做出决定。", judgment_4: "每一个重要决定，我都能罗列充分的理由。",
          love_of_learning_1: "我喜爱学习新事物。", love_of_learning_2: "我总是热衷参与各种学习活动。", love_of_learning_3: "我一定是一位终身学习者。", love_of_learning_4: "我从未错过学习新事物的机会。",
          perspective_1: "我是一个很有智慧的人。", perspective_2: "别人认为我是一个有洞见的人。", perspective_3: "别人总会向我询问意见。", perspective_4: "我精于融会贯通不同领域的知识。",
          bravery_1: "要公开表达不受欢迎但有用的言论，我不会迟疑。", bravery_2: "当我听到某人对他人说出不厚道的话时，我会表达异议。", bravery_3: "我是一位勇敢的人。", bravery_4: "面对强大的反对，我會秉持自己的立场。",
          perseverance_1: "尽管途中有所阻碍，我一定会完成事情。", perseverance_2: "我擅长完成任务，不管它们有多困难。", perseverance_3: "我总是能有始有终。", perseverance_4: "我从不半途而废。",
          honesty_1: "我的承诺值得完全信任。", honesty_2: "我总是信守承诺。", honesty_3: "隐瞒或说慌是有必要的。", honesty_4: "我会说实话尽管这意味着我会惹上麻烦。",
          zest_1: "我总是兴奋地开展每一天。", zest_2: "人们会描述我是充满热忱的。", zest_3: "我天天活力充沛。", zest_4: "我为一天中的各种可能性感到兴奋。",
          love_1: "我可以安心地接纳他人的爱。", love_2: "我会非常努力去鼓舞失落的人。", love_3: "我擅长向他人表达我的关爱。", love_4: "我时常表达我对于他人的爱。",
          kindness_1: "我总是乐于主动帮助朋友一些小忙。", kindness_2: "帮助朋友对我而言从不感到压力。", kindness_3: "我总是尽力去帮助有需要的人。", kindness_4: "我相信每个人有自己的责任，很少帮助别人。",
          social_intel_1: "我总是懂得说出让人们感觉美好的话。", social_intel_2: "我总是和我刚认识的人相处得很好。", social_intel_3: "我总能和别人维持长久而深厚的关系。", social_intel_4: "我能轻易体会他人所处的情境与想法。",
          teamwork_1: "当我是一个团队成员时，我会尽力工作。", teamwork_2: "我真的乐于成为团体的一员。", teamwork_3: "对我而言，尊重团队所做的决定极其重要。", teamwork_4: "我给予我的团队成员绝对的支持。",
          fairness_1: "我平等对待每个人。", fairness_2: "我从不因个人好恶而影响公正判断。", fairness_3: "即使我不喜欢某人，我也会公平地对待他。", fairness_4: "我不预设任何成见去评断他人。",
          leadership_1: "人们总是找我来领导一个团体。", leadership_2: "我非常擅长带领团队活动。", leadership_3: "我擅于协助一群有差异的人彼此合作。", leadership_4: "我总能鼓励并激发团队成员的潜能。",
          forgiveness_1: "我认为最好的事是原谅与遗忘。", forgiveness_2: "我不想看到任何人受苦，即使是与我为敌的人。", forgiveness_3: "我从不怀恨在心。", forgiveness_4: "我总是愿意给予别人改正的机会。",
          humility_1: "对于发生在我身上的好事，我总是谦虚以对。", humility_2: "我绝不自夸我的成就。", humility_3: "我偏好多听别人的经验之谈。", humility_4: "有人说谦逊是我的特质之一。",
          prudence_1: "我总能在说话前先三思。", prudence_2: "我总是做出审慎的选择。", prudence_3: "我是一位非常谨慎小心的人。", prudence_4: "在行动之前，我会极其认真考虑后果。",
          self_regulation_1: "当我工作时，我不会轻易分心。", self_regulation_2: "对我而言，维持自律并不困难。", self_regulation_3: "我能克制自己停止没有建设性的行为。", self_regulation_4: "我能抗拒诱惑。",
          beauty_excellence_1: "我总能会从他人忽略的事物中看见美好。", beauty_excellence_2: "当我看到美丽事物时，我会深受感动。", beauty_excellence_3: "对我而言，生活在美好环境十分重要。", beauty_excellence_4: "我总能觉察周遭的自然美。",
          gratitude_1: "我每天至少一次会列举上天所赐予的恩惠。", gratitude_2: "我是一位非常懂得感恩的人。", gratitude_3: "我的生命中幸运之事接踵而至。", gratitude_4: "当我感到沮丧时，总会想及我生命中的美好事物。",
          hope_1: "面对挑战时，我依然对未来充满希望。", hope_2: "我习惯在负面情况中发现正面机会。", hope_3: "我相信我能实现我设定的目标。", hope_4: "我坚信逆境终将过去，迎向更好的未来。",
          humor_1: "我总能用幽默缓和尴尬或紧张的场面。", humor_2: "我每天都用机智的玩笑逗乐身边的人。", humor_3: "我擅于在日常琐事中发现好笑的一面。", humor_4: "我懂得拿捏玩笑分寸，并用幽默带给他人正面感受。",
          spirituality_1: "我的信念支撑了我生命的意义。", spirituality_2: "我是一位具有灵性信仰的人。", spirituality_3: "我相信我在这个世界上有一个使命。", spirituality_4: "我的信念塑造了现在的我。",
        }
      }
    };

    // 此函式根據選擇的語言生成問卷資料
    const getTranslatedData = (lang) => {
      const T = translations[lang];

      const characterStrengthQuestions = [
        { category: T.strengths.creativity, virtue: T.virtues.wisdom, questions: [
            { id: "creativity_1", text: T.questions.creativity_1, isReverse: false }, { id: "creativity_2", text: T.questions.creativity_2, isReverse: false }, { id: "creativity_3", text: T.questions.creativity_3, isReverse: false }, { id: "creativity_4", text: T.questions.creativity_4, isReverse: false },
        ]},
        { category: T.strengths.curiosity, virtue: T.virtues.wisdom, questions: [
            { id: "curiosity_1", text: T.questions.curiosity_1, isReverse: false }, { id: "curiosity_2", text: T.questions.curiosity_2, isReverse: false }, { id: "curiosity_3", text: T.questions.curiosity_3, isReverse: false }, { id: "curiosity_4", text: T.questions.curiosity_4, isReverse: false },
        ]},
        { category: T.strengths.judgment, virtue: T.virtues.wisdom, questions: [
            { id: "judgment_1", text: T.questions.judgment_1, isReverse: false }, { id: "judgment_2", text: T.questions.judgment_2, isReverse: false }, { id: "judgment_3", text: T.questions.judgment_3, isReverse: false }, { id: "judgment_4", text: T.questions.judgment_4, isReverse: false },
        ]},
        { category: T.strengths.love_of_learning, virtue: T.virtues.wisdom, questions: [
            { id: "love_of_learning_1", text: T.questions.love_of_learning_1, isReverse: false }, { id: "love_of_learning_2", text: T.questions.love_of_learning_2, isReverse: false }, { id: "love_of_learning_3", text: T.questions.love_of_learning_3, isReverse: false }, { id: "love_of_learning_4", text: T.questions.love_of_learning_4, isReverse: false },
        ]},
        { category: T.strengths.perspective, virtue: T.virtues.wisdom, questions: [
            { id: "perspective_1", text: T.questions.perspective_1, isReverse: false }, { id: "perspective_2", text: T.questions.perspective_2, isReverse: false }, { id: "perspective_3", text: T.questions.perspective_3, isReverse: false }, { id: "perspective_4", text: T.questions.perspective_4, isReverse: false },
        ]},
        { category: T.strengths.bravery, virtue: T.virtues.courage, questions: [
            { id: "bravery_1", text: T.questions.bravery_1, isReverse: false }, { id: "bravery_2", text: T.questions.bravery_2, isReverse: false }, { id: "bravery_3", text: T.questions.bravery_3, isReverse: false }, { id: "bravery_4", text: T.questions.bravery_4, isReverse: false },
        ]},
        { category: T.strengths.perseverance, virtue: T.virtues.courage, questions: [
            { id: "perseverance_1", text: T.questions.perseverance_1, isReverse: false }, { id: "perseverance_2", text: T.questions.perseverance_2, isReverse: false }, { id: "perseverance_3", text: T.questions.perseverance_3, isReverse: false }, { id: "perseverance_4", text: T.questions.perseverance_4, isReverse: false },
        ]},
        { category: T.strengths.honesty, virtue: T.virtues.courage, questions: [
            { id: "honesty_1", text: T.questions.honesty_1, isReverse: false }, { id: "honesty_2", text: T.questions.honesty_2, isReverse: false }, { id: "honesty_3", text: T.questions.honesty_3, isReverse: true }, { id: "honesty_4", text: T.questions.honesty_4, isReverse: false },
        ]},
        { category: T.strengths.zest, virtue: T.virtues.courage, questions: [
            { id: "zest_1", text: T.questions.zest_1, isReverse: false }, { id: "zest_2", text: T.questions.zest_2, isReverse: false }, { id: "zest_3", text: T.questions.zest_3, isReverse: false }, { id: "zest_4", text: T.questions.zest_4, isReverse: false },
        ]},
        { category: T.strengths.love, virtue: T.virtues.humanity, questions: [
            { id: "love_1", text: T.questions.love_1, isReverse: false }, { id: "love_2", text: T.questions.love_2, isReverse: false }, { id: "love_3", text: T.questions.love_3, isReverse: false }, { id: "love_4", text: T.questions.love_4, isReverse: false },
        ]},
        { category: T.strengths.kindness, virtue: T.virtues.humanity, questions: [
            { id: "kindness_1", text: T.questions.kindness_1, isReverse: false }, { id: "kindness_2", text: T.questions.kindness_2, isReverse: false }, { id: "kindness_3", text: T.questions.kindness_3, isReverse: false }, { id: "kindness_4", text: T.questions.kindness_4, isReverse: true },
        ]},
        { category: T.strengths.social_intelligence, virtue: T.virtues.humanity, questions: [
            { id: "social_intel_1", text: T.questions.social_intel_1, isReverse: false }, { id: "social_intel_2", text: T.questions.social_intel_2, isReverse: false }, { id: "social_intel_3", text: T.questions.social_intel_3, isReverse: false }, { id: "social_intel_4", text: T.questions.social_intel_4, isReverse: false },
        ]},
        { category: T.strengths.teamwork, virtue: T.virtues.justice, questions: [
            { id: "teamwork_1", text: T.questions.teamwork_1, isReverse: false }, { id: "teamwork_2", text: T.questions.teamwork_2, isReverse: false }, { id: "teamwork_3", text: T.questions.teamwork_3, isReverse: false }, { id: "teamwork_4", text: T.questions.teamwork_4, isReverse: false },
        ]},
        { category: T.strengths.fairness, virtue: T.virtues.justice, questions: [
            { id: "fairness_1", text: T.questions.fairness_1, isReverse: false }, { id: "fairness_2", text: T.questions.fairness_2, isReverse: false }, { id: "fairness_3", text: T.questions.fairness_3, isReverse: false }, { id: "fairness_4", text: T.questions.fairness_4, isReverse: false },
        ]},
        { category: T.strengths.leadership, virtue: T.virtues.justice, questions: [
            { id: "leadership_1", text: T.questions.leadership_1, isReverse: false }, { id: "leadership_2", text: T.questions.leadership_2, isReverse: false }, { id: "leadership_3", text: T.questions.leadership_3, isReverse: false }, { id: "leadership_4", text: T.questions.leadership_4, isReverse: false },
        ]},
        { category: T.strengths.forgiveness, virtue: T.virtues.temperance, questions: [
            { id: "forgiveness_1", text: T.questions.forgiveness_1, isReverse: false }, { id: "forgiveness_2", text: T.questions.forgiveness_2, isReverse: false }, { id: "forgiveness_3", text: T.questions.forgiveness_3, isReverse: false }, { id: "forgiveness_4", text: T.questions.forgiveness_4, isReverse: false },
        ]},
        { category: T.strengths.humility, virtue: T.virtues.temperance, questions: [
            { id: "humility_1", text: T.questions.humility_1, isReverse: false }, { id: "humility_2", text: T.questions.humility_2, isReverse: false }, { id: "humility_3", text: T.questions.humility_3, isReverse: false }, { id: "humility_4", text: T.questions.humility_4, isReverse: false },
        ]},
        { category: T.strengths.prudence, virtue: T.virtues.temperance, questions: [
            { id: "prudence_1", text: T.questions.prudence_1, isReverse: false }, { id: "prudence_2", text: T.questions.prudence_2, isReverse: false }, { id: "prudence_3", text: T.questions.prudence_3, isReverse: false }, { id: "prudence_4", text: T.questions.prudence_4, isReverse: false },
        ]},
        { category: T.strengths.self_regulation, virtue: T.virtues.temperance, questions: [
            { id: "self_regulation_1", text: T.questions.self_regulation_1, isReverse: false }, { id: "self_regulation_2", text: T.questions.self_regulation_2, isReverse: false }, { id: "self_regulation_3", text: T.questions.self_regulation_3, isReverse: false }, { id: "self_regulation_4", text: T.questions.self_regulation_4, isReverse: false },
        ]},
        { category: T.strengths.appreciation_of_beauty, virtue: T.virtues.transcendence, questions: [
            { id: "beauty_excellence_1", text: T.questions.beauty_excellence_1, isReverse: false }, { id: "beauty_excellence_2", text: T.questions.beauty_excellence_2, isReverse: false }, { id: "beauty_excellence_3", text: T.questions.beauty_excellence_3, isReverse: false }, { id: "beauty_excellence_4", text: T.questions.beauty_excellence_4, isReverse: false },
        ]},
        { category: T.strengths.gratitude, virtue: T.virtues.transcendence, questions: [
            { id: "gratitude_1", text: T.questions.gratitude_1, isReverse: false }, { id: "gratitude_2", text: T.questions.gratitude_2, isReverse: false }, { id: "gratitude_3", text: T.questions.gratitude_3, isReverse: false }, { id: "gratitude_4", text: T.questions.gratitude_4, isReverse: false },
        ]},
        { category: T.strengths.hope, virtue: T.virtues.transcendence, questions: [
            { id: "hope_1", text: T.questions.hope_1, isReverse: false }, { id: "hope_2", text: T.questions.hope_2, isReverse: false }, { id: "hope_3", text: T.questions.hope_3, isReverse: false }, { id: "hope_4", text: T.questions.hope_4, isReverse: false },
        ]},
        { category: T.strengths.humor, virtue: T.virtues.transcendence, questions: [
            { id: "humor_1", text: T.questions.humor_1, isReverse: false }, { id: "humor_2", text: T.questions.humor_2, isReverse: false }, { id: "humor_3", text: T.questions.humor_3, isReverse: false }, { id: "humor_4", text: T.questions.humor_4, isReverse: false },
        ]},
        { category: T.strengths.spirituality, virtue: T.virtues.transcendence, questions: [
            { id: "spirituality_1", text: T.questions.spirituality_1, isReverse: false }, { id: "spirituality_2", text: T.questions.spirituality_2, isReverse: false }, { id: "spirituality_3", text: T.questions.spirituality_3, isReverse: false }, { id: "spirituality_4", text: T.questions.spirituality_4, isReverse: false },
        ]},
      ];

      const virtuesInfo = [
        { name: T.virtues.wisdom, desc: T.virtue_desc.wisdom },
        { name: T.virtues.courage, desc: T.virtue_desc.courage },
        { name: T.virtues.humanity, desc: T.virtue_desc.humanity },
        { name: T.virtues.justice, desc: T.virtue_desc.justice },
        { name: T.virtues.temperance, desc: T.virtue_desc.temperance },
        { name: T.virtues.transcendence, desc: T.virtue_desc.transcendence },
      ];
      
      const virtueColors = {
        [T.virtues.wisdom]: ["#2F6DA5", "#BBD3E1"],
        [T.virtues.courage]: ["#D9573F", "#F4CAC3"],
        [T.virtues.humanity]: ["#F29F05", "#F9E0B7"],
        [T.virtues.justice]: ["#679436", "#C7D9C2"],
        [T.virtues.temperance]: ["#AF8EB5", "#E4DAE9"],
        [T.virtues.transcendence]: ["#4D9F8F", "#C8E3DE"],
      };

      return { characterStrengthQuestions, virtuesInfo, virtueColors };
    };

    /**********************************************
     * 靜態資料 (不需翻譯)
     **********************************************/

    // 預先排序好的問題順序（避免同一個性格強項的問題連續出現）
    // 注意：這裡的 virtue 和 category 只是 key，在渲染時會被替換為翻譯後的文字
    const shuffledQuestionsOrder = [
      // Page 1
      {virtueKey: "wisdom", categoryKey: "creativity", index: 0},
      {virtueKey: "courage", categoryKey: "bravery", index: 0},
      {virtueKey: "humanity", categoryKey: "love", index: 0},
      {virtueKey: "justice", categoryKey: "teamwork", index: 0},
      {virtueKey: "temperance", categoryKey: "forgiveness", index: 0},
      {virtueKey: "transcendence", categoryKey: "appreciation_of_beauty", index: 0},
      {virtueKey: "wisdom", categoryKey: "curiosity", index: 0},
      {virtueKey: "courage", categoryKey: "perseverance", index: 0},
      {virtueKey: "humanity", categoryKey: "kindness", index: 0},
      {virtueKey: "justice", categoryKey: "fairness", index: 0},
      // Page 2
      {virtueKey: "temperance", categoryKey: "humility", index: 0},
      {virtueKey: "transcendence", categoryKey: "gratitude", index: 0},
      {virtueKey: "wisdom", categoryKey: "judgment", index: 0},
      {virtueKey: "courage", categoryKey: "honesty", index: 0},
      {virtueKey: "humanity", categoryKey: "social_intelligence", index: 0},
      {virtueKey: "justice", categoryKey: "leadership", index: 0},
      {virtueKey: "temperance", categoryKey: "prudence", index: 0},
      {virtueKey: "transcendence", categoryKey: "hope", index: 0},
      {virtueKey: "wisdom", categoryKey: "love_of_learning", index: 0},
      {virtueKey: "courage", categoryKey: "zest", index: 0},
      // Page 3
      {virtueKey: "humanity", categoryKey: "love", index: 1},
      {virtueKey: "justice", categoryKey: "teamwork", index: 1},
      {virtueKey: "temperance", categoryKey: "self_regulation", index: 0},
      {virtueKey: "transcendence", categoryKey: "humor", index: 0},
      {virtueKey: "wisdom", categoryKey: "perspective", index: 0},
      {virtueKey: "courage", categoryKey: "bravery", index: 1},
      {virtueKey: "humanity", categoryKey: "kindness", index: 1},
      {virtueKey: "justice", categoryKey: "fairness", index: 1},
      {virtueKey: "temperance", categoryKey: "forgiveness", index: 1},
      {virtueKey: "transcendence", categoryKey: "spirituality", index: 0},
      // Page 4
      {virtueKey: "wisdom", categoryKey: "creativity", index: 1},
      {virtueKey: "courage", categoryKey: "perseverance", index: 1},
      {virtueKey: "humanity", categoryKey: "social_intelligence", index: 1},
      {virtueKey: "justice", categoryKey: "leadership", index: 1},
      {virtueKey: "temperance", categoryKey: "humility", index: 1},
      {virtueKey: "transcendence", categoryKey: "appreciation_of_beauty", index: 1},
      {virtueKey: "wisdom", categoryKey: "curiosity", index: 1},
      {virtueKey: "courage", categoryKey: "honesty", index: 1},
      {virtueKey: "humanity", categoryKey: "love", index: 2},
      {virtueKey: "justice", categoryKey: "teamwork", index: 2},
      // Page 5
      {virtueKey: "temperance", categoryKey: "prudence", index: 1},
      {virtueKey: "transcendence", categoryKey: "gratitude", index: 1},
      {virtueKey: "wisdom", categoryKey: "judgment", index: 1},
      {virtueKey: "courage", categoryKey: "zest", index: 1},
      {virtueKey: "humanity", categoryKey: "kindness", index: 2},
      {virtueKey: "justice", categoryKey: "fairness", index: 2},
      {virtueKey: "temperance", categoryKey: "self_regulation", index: 1},
      {virtueKey: "transcendence", categoryKey: "hope", index: 1},
      {virtueKey: "wisdom", categoryKey: "love_of_learning", index: 1},
      {virtueKey: "courage", categoryKey: "bravery", index: 2},
      // Page 6
      {virtueKey: "humanity", categoryKey: "social_intelligence", index: 2},
      {virtueKey: "justice", categoryKey: "leadership", index: 2},
      {virtueKey: "temperance", categoryKey: "forgiveness", index: 2},
      {virtueKey: "transcendence", categoryKey: "humor", index: 1},
      {virtueKey: "wisdom", categoryKey: "perspective", index: 1},
      {virtueKey: "courage", categoryKey: "perseverance", index: 2},
      {virtueKey: "humanity", categoryKey: "love", index: 3},
      {virtueKey: "justice", categoryKey: "teamwork", index: 3},
      {virtueKey: "temperance", categoryKey: "humility", index: 2},
      {virtueKey: "transcendence", categoryKey: "spirituality", index: 1},
      // Page 7
      {virtueKey: "wisdom", categoryKey: "creativity", index: 2},
      {virtueKey: "courage", categoryKey: "honesty", index: 2},
      {virtueKey: "humanity", categoryKey: "kindness", index: 3},
      {virtueKey: "justice", categoryKey: "fairness", index: 3},
      {virtueKey: "temperance", categoryKey: "prudence", index: 2},
      {virtueKey: "transcendence", categoryKey: "appreciation_of_beauty", index: 2},
      {virtueKey: "wisdom", categoryKey: "curiosity", index: 2},
      {virtueKey: "courage", categoryKey: "zest", index: 2},
      {virtueKey: "humanity", categoryKey: "social_intelligence", index: 3},
      {virtueKey: "justice", categoryKey: "leadership", index: 3},
      // Page 8
      {virtueKey: "temperance", categoryKey: "self_regulation", index: 2},
      {virtueKey: "transcendence", categoryKey: "gratitude", index: 2},
      {virtueKey: "wisdom", categoryKey: "judgment", index: 2},
      {virtueKey: "courage", categoryKey: "bravery", index: 3},
      {virtueKey: "humanity", categoryKey: "love", index: 4}, // No question at index 4 for love, this is an error in the original file. Will be filtered out.
      {virtueKey: "justice", categoryKey: "teamwork", index: 4}, // No question at index 4 for teamwork, this is an error in the original file. Will be filtered out.
      {virtueKey: "temperance", categoryKey: "forgiveness", index: 3},
      {virtueKey: "transcendence", categoryKey: "hope", index: 2},
      {virtueKey: "wisdom", categoryKey: "love_of_learning", index: 2},
      {virtueKey: "courage", categoryKey: "perseverance", index: 3},
      // Page 9
      {virtueKey: "humanity", categoryKey: "kindness", index: 4}, // No question at index 4 for kindness.
      {virtueKey: "justice", categoryKey: "fairness", index: 4}, // No question at index 4 for fairness.
      {virtueKey: "temperance", categoryKey: "humility", index: 3},
      {virtueKey: "transcendence", categoryKey: "humor", index: 2},
      {virtueKey: "wisdom", categoryKey: "perspective", index: 2},
      {virtueKey: "courage", categoryKey: "honesty", index: 3},
      {virtueKey: "humanity", categoryKey: "social_intelligence", index: 4}, // No question at index 4 for social intelligence.
      {virtueKey: "temperance", categoryKey: "prudence", index: 3},
      {virtueKey: "transcendence", categoryKey: "spirituality", index: 2},
      {virtueKey: "wisdom", categoryKey: "creativity", index: 3},
      // Page 10
      {virtueKey: "courage", categoryKey: "zest", index: 3},
      {virtueKey: "temperance", categoryKey: "self_regulation", index: 3},
      {virtueKey: "transcendence", categoryKey: "appreciation_of_beauty", index: 3},
      {virtueKey: "wisdom", categoryKey: "curiosity", index: 3},
      {virtueKey: "courage", categoryKey: "bravery", index: 4}, // No question
      {virtueKey: "temperance", categoryKey: "forgiveness", index: 4}, // No question
      {virtueKey: "transcendence", categoryKey: "gratitude", index: 3},
      {virtueKey: "wisdom", categoryKey: "judgment", index: 3},
      {virtueKey: "courage", categoryKey: "perseverance", index: 4}, // No question
      {virtueKey: "transcendence", categoryKey: "hope", index: 3},
      // Page 11
      {virtueKey: "wisdom", categoryKey: "love_of_learning", index: 3},
      {virtueKey: "courage", categoryKey: "honesty", index: 4}, // No question
      {virtueKey: "temperance", categoryKey: "humility", index: 4}, // No question
      {virtueKey: "transcendence", categoryKey: "humor", index: 3},
      {virtueKey: "wisdom", categoryKey: "perspective", index: 3},
      {virtueKey: "courage", categoryKey: "zest", index: 4}, // No question
      {virtueKey: "temperance", categoryKey: "prudence", index: 4}, // No question
      {virtueKey: "transcendence", categoryKey: "spirituality", index: 3},
      {virtueKey: "transcendence", categoryKey: "appreciation_of_beauty", index: 4}, // No question
      {virtueKey: "transcendence", categoryKey: "gratitude", index: 4}, // No question
      // Page 12 (These are all errors in original file as no category has 5 questions)
      {virtueKey: "transcendence", categoryKey: "hope", index: 4},
      {virtueKey: "transcendence", categoryKey: "humor", index: 4},
      {virtueKey: "transcendence", categoryKey: "spirituality", index: 4},
      {virtueKey: "wisdom", categoryKey: "creativity", index: 4},
      {virtueKey: "wisdom", categoryKey: "curiosity", index: 4},
      {virtueKey: "wisdom", categoryKey: "judgment", index: 4},
      {virtueKey: "wisdom", categoryKey: "love_of_learning", index: 4},
      {virtueKey: "wisdom", categoryKey: "perspective", index: 4},
      {virtueKey: "temperance", categoryKey: "self_regulation", index: 4},
      {virtueKey: "justice", categoryKey: "leadership", index: 4},
    ];

    /**********************************************
     * React 組件 VIACharacterSurvey
     **********************************************/
    function VIACharacterSurvey() {
      // 語言狀態
      const [language, setLanguage] = useState('zh-TW');
      
      // 使用 useMemo 根據語言生成資料，避免不必要的重新計算
      const { characterStrengthQuestions, virtuesInfo, virtueColors } = useMemo(() => getTranslatedData(language), [language]);
      
      // 翻譯函式
      const t = (key, ...args) => {
          const value = translations[language][key];
          if (typeof value === 'function') {
              return value(...args);
          }
          return value || key;
      };

      // 攤平所有題目，使用預排序的順序
      const allQuestions = useMemo(() => {
        return shuffledQuestionsOrder.map(item => {
          const categoryName = translations[language].strengths[item.categoryKey];
          const virtueName = translations[language].virtues[item.virtueKey];

          const categoryGroup = characterStrengthQuestions.find(g =>
            g.category === categoryName && g.virtue === virtueName
          );

          if (!categoryGroup || !categoryGroup.questions[item.index]) {
            // 修正原始檔案中不存在的問題 (例如 index 4)
            return null;
          }
          
          const question = categoryGroup.questions[item.index];
          
          return {
            ...question,
            category: categoryGroup.category,
            virtue: categoryGroup.virtue
          };
        }).filter(q => q !== null); // 過濾掉空值
      }, [language, characterStrengthQuestions]);
      
      // 首頁 (尚未開始)
      const [hasStarted, setHasStarted] = useState(false);

      // 問卷回答 (題目 id -> 分數)
      const [answers, setAnswers] = useState({});
      const [submitted, setSubmitted] = useState(false);

      // 每頁 10 題
      const [currentPage, setCurrentPage] = useState(0);
      const questionsPerPage = 10;
      const totalPages = Math.ceil(allQuestions.length / questionsPerPage);

      // 分頁顯示用
      const startIndex = currentPage * questionsPerPage;
      const endIndex = startIndex + questionsPerPage;
      const pageQuestions = allQuestions.slice(startIndex, endIndex);

      // 進度條
      const totalQuestions = allQuestions.length;
      const answeredCount = Object.keys(answers).length;
      const progressPercentage = totalQuestions > 0 ? Math.round((answeredCount / totalQuestions) * 100) : 0;

      /**********************************************
       * 事件處理
       **********************************************/

      const handleStart = () => setHasStarted(true);
      const handleAnswerChange = (questionId, score) => setAnswers(prev => ({ ...prev, [questionId]: score }));

      const handleClearPageAnswers = () => {
        if (window.confirm(t('clearConfirm'))) {
          const updatedAnswers = { ...answers };
          pageQuestions.forEach(question => delete updatedAnswers[question.id]);
          setAnswers(updatedAnswers);
        }
      };

      const handleNextPage = () => {
        const unanswered = pageQuestions.filter((q) => answers[q.id] === undefined);
        if (unanswered.length > 0) {
          let errorMsg = t('unansweredAlert');
          unanswered.forEach((u) => { errorMsg += `• ${u.text}\n`; });
          alert(errorMsg);
          return;
        }
        if (currentPage < totalPages - 1) setCurrentPage(prev => prev + 1);
      };
      
      const handlePrevPage = () => {
        if (currentPage > 0) setCurrentPage(prev => prev - 1);
      };

      const handleSubmit = () => {
        if (answeredCount < totalQuestions) {
          alert(t('incompleteAlert'));
          return;
        }
        setSubmitted(true);
      };

      /**********************************************
       * 統計函式 (維持不變)
       **********************************************/
      const getCategoryAverages = () => {
        const sumsAndCounts = characterStrengthQuestions.reduce((acc, group) => {
          acc[group.category] = { sum: 0, count: 0, virtue: group.virtue };
          return acc;
        }, {});
        
        allQuestions.forEach((q) => {
          let userScore = answers[q.id];
          if (typeof userScore === "number") {
            if (q.isReverse) {
              userScore = 6 - userScore;
            }
            sumsAndCounts[q.category].sum += userScore;
            sumsAndCounts[q.category].count += 1;
          }
        });
        
        const resultArray = Object.entries(sumsAndCounts).map(([category, data]) => ({
          category,
          virtue: data.virtue,
          avg: data.count > 0 ? data.sum / data.count : 0,
        }));
        
        return sortWithDiverseVirtues(resultArray);
      };

      const sortWithDiverseVirtues = (inputArray) => {
        inputArray.sort((a, b) => b.avg - a.avg);
        const finalResult = [];
        const selectedVirtues = new Set();
        const scoreGroups = {};
        for (const item of inputArray) {
          const scoreKey = item.avg.toFixed(3);
          if (!scoreGroups[scoreKey]) scoreGroups[scoreKey] = [];
          scoreGroups[scoreKey].push(item);
        }
        const sortedScores = Object.keys(scoreGroups).sort((a, b) => parseFloat(b) - parseFloat(a));
        for (const scoreKey of sortedScores) {
          const sameScoreItems = scoreGroups[scoreKey];
          if (sameScoreItems.length === 1) {
            finalResult.push(sameScoreItems[0]);
            selectedVirtues.add(sameScoreItems[0].virtue);
            continue;
          }
          const newVirtueItems = sameScoreItems.filter(item => !selectedVirtues.has(item.virtue));
          const repeatedVirtueItems = sameScoreItems.filter(item => selectedVirtues.has(item.virtue));
          newVirtueItems.sort((a, b) => a.category.localeCompare(b.category));
          repeatedVirtueItems.sort((a, b) => a.category.localeCompare(b.category));
          for (const item of newVirtueItems) {
            finalResult.push(item);
            selectedVirtues.add(item.virtue);
          }
          for (const item of repeatedVirtueItems) {
            finalResult.push(item);
          }
        }
        return finalResult;
      };

      /**********************************************
       * 語言切換器組件
       **********************************************/
      const LanguageSwitcher = () => React.createElement("div", { className: "absolute top-4 right-4 z-10" },
        React.createElement("div", { className: "flex space-x-1 bg-gray-200 p-1 rounded-lg" },
          React.createElement("button", {
            onClick: () => setLanguage('zh-TW'),
            className: `px-3 py-1 text-sm font-medium rounded-md transition-colors ${language === 'zh-TW' ? 'bg-white text-blue-600 shadow' : 'text-gray-600 hover:bg-gray-300'}`
          }, "繁體中文"),
          React.createElement("button", {
            onClick: () => setLanguage('zh-CN'),
            className: `px-3 py-1 text-sm font-medium rounded-md transition-colors ${language === 'zh-CN' ? 'bg-white text-blue-600 shadow' : 'text-gray-600 hover:bg-gray-300'}`
          }, "简体中文")
        )
      );

      /**********************************************
       * 畫面渲染
       **********************************************/
      
      const mainContentClass = "max-w-3xl w-full bg-white rounded-xl shadow-lg overflow-hidden relative";

      // 1. 首頁 (尚未開始)
      if (!hasStarted) {
        return (
          React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex flex-col items-center justify-center p-4" },
            React.createElement("div", { className: "max-w-3xl w-full bg-white rounded-xl shadow-lg overflow-hidden relative" },
              React.createElement(LanguageSwitcher),
              React.createElement("div", { className: "bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white" },
                React.createElement("h1", { className: "text-3xl font-bold tracking-tight" }, t('surveyTitle')),
                React.createElement("p", { className: "mt-2 opacity-90" }, t('surveySubtitle'))
              ),
              React.createElement("div", { className: "p-8" },
                React.createElement("div", { className: "flex flex-col md:flex-row gap-8" },
                  React.createElement("div", { className: "flex-1" },
                    React.createElement("h2", { className: "text-xl font-semibold text-gray-800 mb-4" }, t('aboutSurvey')),
                    React.createElement("p", { className: "text-gray-600 mb-4" }, t('aboutSurveyP1')),
                    React.createElement("p", { className: "text-gray-600 mb-6" }, t('aboutSurveyP2')),
                    React.createElement("div", { className: "bg-blue-50 border-l-4 border-blue-500 p-4 mb-6" },
                      React.createElement("h3", { className: "font-medium text-blue-800" }, t('whatSurveyHelps')),
                      React.createElement("ul", { className: "mt-2 text-blue-700 space-y-1" },
                        React.createElement("li", null, t('helpListItem1')),
                        React.createElement("li", null, t('helpListItem2')),
                        React.createElement("li", null, t('helpListItem3'))
                      )
                    )
                  ),
                  React.createElement("div", { className: "flex-1 flex flex-col justify-between" },
                    React.createElement("div", { className: "bg-gray-50 p-5 rounded-lg mb-6" },
                      React.createElement("h3", { className: "text-lg font-medium text-gray-800 mb-3" }, t('sixVirtues')),
                      React.createElement("div", { className: "grid grid-cols-2 gap-3" },
                        virtuesInfo.map((virtue, index) => (
                          React.createElement("div", { key: index, className: "p-3 rounded-md", style: { backgroundColor: virtueColors[virtue.name][1] } },
                            React.createElement("span", { className: "font-medium", style: { color: virtueColors[virtue.name][0] } }, virtue.name.split(" (")[0])
                          )
                        ))
                      )
                    ),
                    React.createElement("button", { onClick: handleStart, className: "w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-4 px-6 rounded-lg font-medium text-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200" },
                      t('startTestBtn')
                    )
                  )
                ),
                React.createElement("div", { className: "mt-8 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm" }, t('surveyDisclaimer'))
              )
            )
          )
        );
      }

      // 2. 問卷填寫中 (尚未提交)
      if (!submitted) {
        return (
          React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-8 px-4" },
            React.createElement("div", { className: "max-w-3xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden relative" },
              React.createElement(LanguageSwitcher),
              React.createElement("div", { className: "bg-gradient-to-r from-blue-600 to-indigo-600 p-5 text-white" },
                React.createElement("h1", { className: "text-2xl font-bold" }, t('testTitle')),
                React.createElement("p", { className: "text-sm mt-1 opacity-90" }, t('testInstruction'))
              ),
              React.createElement("div", { className: "p-6" },
                React.createElement("div", { className: "mb-6" },
                  React.createElement("div", { className: "flex justify-between mb-2 text-sm text-gray-600" },
                    React.createElement("span", null, t('progress')),
                    React.createElement("span", { className: "font-medium" }, progressPercentage, "% ", t('completed'))
                  ),
                  React.createElement("div", { className: "w-full bg-gray-200 h-2 rounded-full overflow-hidden" },
                    React.createElement("div", { className: "bg-gradient-to-r from-blue-500 to-indigo-500 h-full rounded-full", style: { width: progressPercentage + "%" }})
                  ),
                  React.createElement("div", { className: "flex justify-between mt-1 text-xs text-gray-400" },
                    React.createElement("span", null, t('pageInfo', currentPage + 1, totalPages)),
                    React.createElement("span", null, t('questionCount', answeredCount, totalQuestions))
                  )
                ),
                React.createElement("div", { className: "mb-6 flex justify-end" },
                  React.createElement("button", { onClick: handleClearPageAnswers, className: "text-red-500 text-sm flex items-center bg-red-50 hover:bg-red-100 px-3 py-1 rounded-md transition-colors" },
                    React.createElement("svg", { className: "w-4 h-4 mr-1", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg" },
                      React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" })
                    ),
                    t('clearPageAnswers')
                  )
                ),
                React.createElement("div", { className: "space-y-6" },
                  pageQuestions.map((question, qIndex) => (
                    React.createElement("div", { key: question.id, className: `p-4 rounded-lg border ${answers[question.id] !== undefined ? "border-green-100 bg-green-50" : "border-gray-200 bg-gray-50"}`},
                      React.createElement("p", { className: "font-medium text-gray-800 mb-3" }, `${startIndex + qIndex + 1}. ${question.text}`),
                      React.createElement("div", { className: "grid grid-cols-5 gap-2 mt-1" },
                        [5, 4, 3, 2, 1].map((score) => (
                          React.createElement("label", { key: score, className: `border rounded-md py-2 px-1 text-center text-sm cursor-pointer transition-all ${answers[question.id] === score ? "bg-blue-100 border-blue-300 text-blue-800" : "bg-white hover:bg-gray-100 border-gray-200 text-gray-700"}` },
                            React.createElement("input", { type: "radio", name: question.id, value: score, checked: answers[question.id] === score, onChange: () => handleAnswerChange(question.id, score), className: "sr-only" }),
                            React.createElement("span", { className: "block font-medium mb-1" }, score),
                            React.createElement("span", { className: "block text-xs" },
                              score === 5 ? t('score5') : score === 4 ? t('score4') : score === 3 ? t('score3') : score === 2 ? t('score2') : t('score1')
                            )
                          )
                        ))
                      )
                    )
                  ))
                ),
                React.createElement("div", { className: "mt-8 flex justify-between items-center" },
                  React.createElement("div", null, currentPage > 0 &&
                    React.createElement("button", { onClick: handlePrevPage, className: "flex items-center bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors" },
                      React.createElement("svg", { className: "w-5 h-5 mr-1", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg" },
                        React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M15 19l-7-7 7-7" })
                      ),
                      t('prevPageBtn')
                    )
                  ),
                  React.createElement("div", null, currentPage < totalPages - 1
                    ? React.createElement("button", { onClick: handleNextPage, className: "flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors" },
                        t('nextPageBtn'),
                        React.createElement("svg", { className: "w-5 h-5 ml-1", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg" },
                          React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M9 5l7 7-7 7" })
                        )
                      )
                    : React.createElement("button", { onClick: handleSubmit, className: "flex items-center bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors" },
                        t('submitBtn'),
                        React.createElement("svg", { className: "w-5 h-5 ml-1", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg" },
                          React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "2", d: "M5 13l4 4L19 7" })
                        )
                      )
                  )
                )
              )
            )
          )
        );
      }

      // 3. 顯示結果 (已提交)
      const categoryData = getCategoryAverages();
      const topFiveStrengths = categoryData.slice(0, 5);

      return (
        React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 py-8 px-4" },
          React.createElement("div", { className: "max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden relative" },
            React.createElement(LanguageSwitcher),
            React.createElement("div", { className: "bg-gradient-to-r from-blue-600 to-indigo-600 p-5 text-white" },
              React.createElement("h1", { className: "text-2xl font-bold" }, t('resultsTitle')),
              React.createElement("p", { className: "text-sm mt-1 opacity-90" }, t('resultsSubtitle'))
            ),
            React.createElement("div", { className: "p-6" },
              React.createElement("div", { className: "bg-blue-50 rounded-lg p-5 mb-8" },
                React.createElement("h2", { className: "text-xl font-semibold text-blue-800 mb-3" }, t('topFiveStrengths')),
                React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-5 gap-4" },
                  topFiveStrengths.map((strength, index) => {
                    const colorArray = virtueColors[strength.virtue] || ["#999", "#ccc"];
                    return (
                      React.createElement("div", { key: index, className: "rounded-lg p-4 text-center shadow-sm", style: { backgroundColor: colorArray[1] } },
                        React.createElement("div", { className: "text-lg font-bold mb-1", style: { color: colorArray[0] } }, `#${index + 1}`),
                        React.createElement("div", { className: "font-medium text-gray-800" }, strength.category.split(" (")[0]),
                        React.createElement("div", { className: "text-sm text-gray-500 mt-1" }, strength.virtue.split(" (")[0]),
                        React.createElement("div", { className: "mt-2 text-lg font-semibold", style: { color: colorArray[0] } }, strength.avg.toFixed(1))
                      )
                    );
                  })
                )
              ),
              React.createElement("div", { className: "p-5 bg-gray-50 border-t border-gray-200 rounded-lg" },
                React.createElement("h3", { className: "text-lg font-semibold text-gray-800 mb-3" }, t('aboutYourStrengths')),
                React.createElement("p", { className: "text-gray-600 mb-3" }, t('aboutStrengthsP1')),
                React.createElement("p", { className: "text-gray-600" }, t('aboutStrengthsP2'))
              ),
              React.createElement("div", { className: "mt-8 text-center" },
                React.createElement("button", {
                  onClick: () => {
                    if (window.confirm(t('restartConfirm'))) {
                      setHasStarted(false);
                      setSubmitted(false);
                      setAnswers({});
                      setCurrentPage(0);
                    }
                  },
                  className: "px-6 py-2 bg-gray-200 rounded-lg text-gray-700 hover:bg-gray-300 transition-colors"
                }, t('restartBtn'))
              )
            )
          )
        )
      );
    }

    // 將 VIACharacterSurvey 掛載到 #preview-app
    ReactDOM.render(
      React.createElement(VIACharacterSurvey, null),
      document.getElementById("preview-app")
    );
  </script>
</body>
</html>
